<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Murugan Laundry Bill</title>
  <style>
    @page { size: A4; margin: 10mm; }
    body { font-family: Arial, sans-serif; margin:0; padding:0; }
    .container { width: 100%; max-width: 700px; margin:auto; padding:5px; border:2px solid black; box-sizing:border-box; }
    .header { text-align:center; }
    .header h2 { font-size:18px; margin:0; text-decoration:underline; }
    .header p { margin:3px 0; font-size:13px; }
    .line { border-bottom:1px solid black; margin:6px 0; }
    .info { display:flex; justify-content:space-between; font-size:12px; }
    .info input { width:100%; padding:3px; font-size:12px; border:none; border-bottom:1px dotted #555; background:transparent; outline:none; }
    table { width:100%; border-collapse:collapse; font-size:11px; margin-top:4px; }
    table, th, td { border:1px solid black; }
    th, td { padding:2px; text-align:center; }
    input[type="text"], input[type="number"], input[type="date"] { box-sizing:border-box; padding:2px; font-size:11px; border:none; border-bottom:1px dotted #555; background:transparent; outline:none; }
    .desc-input { width:100%; }
    .small-input { width:45px; }
    .totals { display:flex; justify-content:space-between; margin-top:8px; }
    .totals .left, .totals .right { width:48%; font-size:11px; }
    .totals .right td { text-align:left; }
    .footer-line { border-top:1px solid black; margin-top:10px; }
    button { display:block; margin:10px auto; padding:6px 14px; font-size:13px; }
    .delete-btn { background:red; color:white; border:none; cursor:pointer; font-size:11px; padding:2px 5px; }
    @media print {
      button { display:none; }
      body { margin:0; }
      .container { border:none; }
      input { border:none !important; outline:none !important; background:none !important; -webkit-appearance:none !important; appearance:none !important; padding:0 !important; }
      input::-webkit-inner-spin-button, input::-webkit-calendar-picker-indicator { display:none !important; -webkit-appearance:none !important; }
      .action-col { display:none; }
    }
  </style>
</head>
<body>

<div class="container" id="invoice">
  <div class="header">
    <h2>MURUGAN LAUNDRY</h2>
    <p>
      <select id="shopAddressSelect" onchange="toggleShopAddressInput(this)" 
        style="display:block; margin:0 auto; border:none; border-bottom:1px dotted #555; background:transparent; outline:none; font-size:13px; text-align:center; width:fit-content;">
        <option value="default">10th Cross, Patel Layout, Balagere Road, Varthur, Bangalore - 87</option>
        <option value="manual">Enter Manually</option>
      </select>
      <input type="text" id="manualShopAddress" 
        style="display:none; margin:0 auto; border:none; border-bottom:1px dotted #555; background:transparent; outline:none; font-size:13px; text-align:center; width:fit-content;" 
        placeholder="Enter Shop Address Here" />
      <span id="finalShopAddress" 
        style="display:none; font-size:13px; text-align:center; display:block; margin:0 auto; width:fit-content;"></span>
    </p>
  </div>

  <div class="line"></div>

  <div class="info">
    <div style="width:48%;">
      <label>Customer Name: <input type="text" /></label><br /><br />
      <label>Contact No.: <input type="text" /></label><br /><br />
      <label>Customer Address: <input type="text" style="width:100%;" /></label>
    </div>
    <div style="width:48%;">
      <label>Order ID: <input type="text" id="orderId"/></label><br /><br />
      <div style="display:flex; justify-content:space-between; gap:5px;">
        <label>Pickup Date: <input type="date" style="width:100px;" /></label>
        <label>Drop Date: <input type="date" style="width:100px;" /></label>
      </div>
    </div>
  </div>

  <div class="line"></div>

  <table id="itemsTable">
    <thead>
      <tr>
        <th>Sl. No.</th>
        <th>Description</th>
        <th>Service</th>
        <th>Price</th>
        <th>Qty.</th>
        <th>Amount</th>
        <th class="action-col">Action</th>
      </tr>
    </thead>
    <tbody>
      <!-- Initial 10 rows -->
      ${Array.from({length:10},(_,i)=>`
      <tr>
        <td>${i+1}</td>
        <td><input type="text" class="desc-input" oninput="checkAddRow(this)" /></td>
        <td><input type="text" /></td>
        <td><input type="number" class="small-input price" oninput="calculateRow(this)" /></td>
        <td><input type="number" class="small-input qty" oninput="calculateRow(this); checkAddRow(this)" /></td>
        <td><span class="amount">0.00</span></td>
        <td class="action-col"><button class="delete-btn" onclick="deleteRow(this)">X</button></td>
      </tr>`).join('')}
    </tbody>
  </table>

  <table>
    <thead>
      <tr><th>Service Type</th><th>Price</th><th>Qty</th><th>Amount</th></tr>
    </thead>
    <tbody>
      <tr>
        <td>Wash & Iron Kg</td>
        <td><input type="number" class="extra-price" value="100" oninput="calculateExtra(this)" /></td>
        <td><input type="number" class="extra-qty" data-price="100" oninput="calculateExtra(this)" /></td>
        <td><span class="extra-amount">0.00</span></td>
      </tr>
      <tr>
        <td>Wash & Fold Kg</td>
        <td><input type="number" class="extra-price" value="75" oninput="calculateExtra(this)" /></td>
        <td><input type="number" class="extra-qty" data-price="75" oninput="calculateExtra(this)" /></td>
        <td><span class="extra-amount">0.00</span></td>
      </tr>
    </tbody>
  </table>

  <div class="totals">
    <div class="left">
      <p><strong>Timings:</strong> 9:00 am to 9:00 pm</p>
      <p><strong>Mob:</strong> <input type="text" value="9113647449, 9880114327" style="width:100%;" /></p>
    </div>
    <div class="right">
      <table>
        <tr><td>Sub Total</td><td>:</td><td><span id="subtotal">0.00</span></td></tr>
        <tr><td>Discount</td><td>:</td><td><input type="number" id="discount" value="0" oninput="calculateTotal()" /></td></tr>
        <tr><td>Other Charges</td><td>:</td><td><input type="text" /></td></tr>
        <tr><td><strong>Gross Amount</strong></td><td>:</td><td><span id="gross">0.00</span></td></tr>
      </table>
    </div>
  </div>

  <div class="footer-line"></div>
</div>

<div style="text-align:center; margin-top:20px;">
  <button onclick="saveAsPDF()">Save to PDF</button>
  <button onclick="printBill()">Print</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
function calculateRow(el) {
  const row = el.closest('tr');
  const price = parseFloat(row.querySelector('.price')?.value || 0);
  const qty = parseFloat(row.querySelector('.qty')?.value || 0);
  row.querySelector('.amount').innerText = (price*qty).toFixed(2);
  calculateTotal();
}
function calculateExtra(el) {
  const row = el.closest('tr');
  const qtyInput = row.querySelector('.extra-qty');
  const priceInput = row.querySelector('.extra-price');
  const qty = parseFloat(qtyInput.value || 0);
  const price = parseFloat(priceInput.value || 0);
  qtyInput.dataset.price = price;
  row.querySelector('.extra-amount').innerText = (price*qty).toFixed(2);
  calculateTotal();
}
function calculateTotal(){
  let total = 0;
  document.querySelectorAll('.amount, .extra-amount').forEach(s => total += parseFloat(s.innerText) || 0);
  document.getElementById('subtotal').innerText = total.toFixed(2);
  const discount = parseFloat(document.getElementById('discount').value) || 0;
  document.getElementById('gross').innerText = (total - discount).toFixed(2);
}

/* SHOP ADDRESS FUNCTIONS */
function toggleShopAddressInput(select){
  const manualInput=document.getElementById("manualShopAddress");
  if(select.value==="manual"){select.style.display="none"; manualInput.style.display="block"; manualInput.focus();}
  else{manualInput.style.display="none"; select.style.display="block";}
}
function prepareShopAddressForOutput(){
  const select=document.getElementById("shopAddressSelect");
  const manualInput=document.getElementById("manualShopAddress");
  const finalSpan=document.getElementById("finalShopAddress");
  let value="";
  if(manualInput.style.display!=="none" && manualInput.value.trim()!==""){value=manualInput.value;}
  else{value=select.options[select.selectedIndex].text;}
  finalSpan.textContent=value; finalSpan.style.display="block"; select.style.display="none"; manualInput.style.display="none";
}
function restoreShopAddressAfterOutput(){
  const select=document.getElementById("shopAddressSelect");
  const manualInput=document.getElementById("manualShopAddress");
  const finalSpan=document.getElementById("finalShopAddress");
  finalSpan.style.display="none";
  if(manualInput.value.trim()!==""){manualInput.style.display="block";}else{select.style.display="block";}
}
function saveAsPDF(){
  const orderId=document.getElementById("orderId").value || "NoID";
  const fileName=`Murugan Laundry Bill - ${orderId}.pdf`;
  document.querySelectorAll("#itemsTable td:nth-child(7), #itemsTable th:nth-child(7)").forEach(el=>el.style.display="none");
  html2pdf().set({margin:10, filename:fileName, image:{type:'jpeg',quality:1}, html2canvas:{scale:3, scrollY:0}, jsPDF:{unit:'mm', format:'a4', orientation:'portrait'}}).from(document.getElementById("invoice")).save().then(()=>{
    document.querySelectorAll("#itemsTable td:nth-child(7), #itemsTable th:nth-child(7)").forEach(el=>el.style.display="");
  });
}
function printBill(){
  document.querySelectorAll("#itemsTable td:nth-child(7), #itemsTable th:nth-child(7)").forEach(el=>el.style.display="none");
  window.print();
  document.querySelectorAll("#itemsTable td:nth-child(7), #itemsTable th:nth-child(7)").forEach(el=>el.style.display="");
}

/* === DYNAMIC ROW FUNCTIONS === */
function checkAddRow(el){
  const row=el.closest('tr');
  const desc=row.querySelector('.desc-input').value.trim();
  const qty=row.querySelector('.qty').value.trim();
  if(desc!=="" && qty!==""){
    const tbody=document.querySelector("#itemsTable tbody");
    if(row===tbody.lastElementChild){
      addNewRow();
    }
  }
}

function addNewRow(){
  const tbody=document.querySelector("#itemsTable tbody");
  const index=tbody.querySelectorAll('tr').length+1;
  const newRow=document.createElement('tr');
  newRow.innerHTML=`
    <td>${index}</td>
    <td><input type="text" class="desc-input" oninput="checkAddRow(this)" /></td>
    <td><input type="text" /></td>
    <td><input type="number" class="small-input price" oninput="calculateRow(this)" /></td>
    <td><input type="number" class="small-input qty" oninput="calculateRow(this); checkAddRow(this)" /></td>
    <td><span class="amount">0.00</span></td>
    <td class="action-col"><button class="delete-btn" onclick="deleteRow(this)">X</button></td>
  `;
  tbody.appendChild(newRow);
}

function deleteRow(btn){
  const row=btn.closest('tr');
  row.remove();
  // Update Sl. No
  const rows=document.querySelectorAll("#itemsTable tbody tr");
  rows.forEach((r,i)=>r.querySelector('td').innerText=i+1);
  calculateTotal();
}
</script>

</body>
</html>
